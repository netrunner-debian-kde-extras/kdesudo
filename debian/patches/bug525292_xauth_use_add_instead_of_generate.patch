Description: Xauth: Use a list-and-add scheme instead of the generate command.
 The "xauth generate" command doesn't work in environments where the SECURITY X
 extension is disabled (like in Debian).
 .
 This is obviously an ugly hack, but "works-hereâ„¢"
Origin: vendor
Bug: http://bugs.debian.org/525292
Forwarded: https://bugs.launchpad.net/kdesudo/+bug/365956
Author: Didier Raboud <didier@raboud.com>
Last-Update: 2009-08-03
Index: kdesudo-3.4.1/kdesudo/kdesudo.cpp
===================================================================
--- kdesudo-3.4.1.orig/kdesudo/kdesudo.cpp	2009-08-03 10:21:39.000000000 +0200
+++ kdesudo-3.4.1/kdesudo/kdesudo.cpp	2009-08-03 10:22:15.000000000 +0200
@@ -163,8 +163,10 @@
 
 	QByteArray disp = m_pCookie->display();
 
-	QString c = "/usr/bin/xauth -q -f " + m_tmpName + " generate " 
-		+ QString::fromLocal8Bit(disp) + " . trusted timeout 60 >/dev/null 2>&1";
+        QString c = "xauth_token=`/usr/bin/xauth -q list " + QString::fromLocal8Bit(disp)
+                              + " | head -n 1 | awk '{ print $3; }'` &&"
+                  + "/usr/bin/xauth -q -f " + m_tmpName + " add " + QString::fromLocal8Bit(disp) + " . $xauth_token 2>/dev/null &&"
+                  + "echo " + m_tmpName;
 
 	blockSigChild();
 	if (!(f = popen(QFile::encodeName(c), "r"))) {
